<th:block th:fragment="editWatchListModal">
    <!-- Modal Edit Watch List -->
    <div
      class="modal fade"
      id="editWatchListModal"
      tabindex="-1"
      aria-labelledby="editWatchListModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <!-- Style Consistent with Add Modal -->
        <div class="modal-content" style="background-color: #fcfbf4; border: 2px solid #000;">
          
          <!-- Header -->
          <div class="modal-header" style="border-bottom: 2px solid #ddd;">
            <h5 class="modal-title fw-bold" id="editWatchListModalLabel" style="color: #1a1a1a;">
              Edit WatchList Data
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <!-- Form: Action ke /save (Controller akan mendeteksi ID untuk update), support Multipart -->
          <form th:action="@{/watchlists/save}" method="post" enctype="multipart/form-data">
            <div class="modal-body">
              
              <!-- Alert Error -->
              <div
                th:if="${error}"
                class="alert alert-danger alert-dismissible fade show"
                role="alert"
              >
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>

              <!-- Hidden ID (Penting untuk Update) -->
              <input type="hidden" id="editWatchListId" name="id" />

              <div class="row">
                <!-- Kolom Kiri: Poster Image (Update Logic) -->
                <div class="col-md-4 mb-3 d-flex flex-column align-items-center">
                    <label class="form-label fw-bold w-100">Poster Image</label>
                    
                    <!-- Area Preview Gambar -->
                    <div class="mb-2" style="width: 100%; height: 250px; border: 2px dashed #c4a45e; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; background-color: #f0eee4; position: relative;">
                        
                        <!-- Gambar Preview (Akan diisi via JS) -->
                        <img id="imgPreviewEdit" src="#" alt="Preview" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                        
                        <!-- Placeholder jika gambar kosong -->
                        <div id="placeholderEdit" class="text-center text-muted">
                            <i class="bi bi-image fs-1"></i>
                            <div style="font-size: 12px;">Current Poster</div>
                        </div>
                    </div>

                    <!-- Input File (Optional untuk Edit) -->
                    <input class="form-control form-control-sm" type="file" id="coverImageEdit" name="coverImage" accept="image/*" onchange="previewImageEdit(this)">
                    <div class="form-text text-muted text-center" style="font-size: 11px;">Leave empty to keep current poster</div>
                </div>

                <!-- Kolom Kanan: Input Fields -->
                <div class="col-md-8">
                    <!-- Title -->
                    <div class="mb-3">
                        <label for="editWatchListTitle" class="form-label fw-bold">
                        Title <span class="text-danger">*</span>
                        </label>
                        <input
                        type="text"
                        class="form-control"
                        id="editWatchListTitle"
                        name="title"
                        placeholder="Movie/Series Title"
                        required
                        />
                    </div>

                    <div class="row">
                        <!-- Type -->
                        <div class="col-md-6 mb-3">
                        <label for="editWatchListType" class="form-label fw-bold">
                            Type <span class="text-danger">*</span>
                        </label>
                        <select class="form-select" id="editWatchListType" name="type" required>
                            <option value="">Select Type</option>
                            <option value="Movie">Movie</option>
                            <option value="Series">Series</option>
                        </select>
                        </div>

                        <!-- Status (UPDATED: 3 Options String) -->
                        <div class="col-md-6 mb-3">
                            <label for="editWatchListStatus" class="form-label fw-bold">
                            Status <span class="text-danger">*</span>
                        </label>
                        <select class="form-select" id="editWatchListStatus" name="status" required>
                            <option value="Plan to Watch">Plan to Watch</option>
                            <option value="Watching">Watching</option>
                            <option value="Watched">Watched</option>
                        </select>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Genre -->
                        <div class="col-md-6 mb-3">
                            <label for="editWatchListGenre" class="form-label fw-bold">
                            Genre <span class="text-danger">*</span>
                            </label>
                            <input
                            type="text"
                            class="form-control"
                            id="editWatchListGenre"
                            name="genre"
                            placeholder="e.g. Action"
                            required
                            />
                        </div>

                        <!-- Release Year -->
                        <div class="col-md-6 mb-3">
                            <label for="editWatchListReleaseYear" class="form-label fw-bold">
                            Release Year <span class="text-danger">*</span>
                            </label>
                            <input
                            type="number"
                            class="form-control"
                            id="editWatchListReleaseYear"
                            name="releaseYear"
                            placeholder="e.g. 2024"
                            required
                            />
                        </div>
                    </div>

                    <!-- Rating -->
                    <div class="mb-3">
                        <label for="editWatchListRating" class="form-label fw-bold">
                        Rating (1-10) <span class="text-danger">*</span>
                        </label>
                        <input
                        type="number"
                        class="form-control"
                        id="editWatchListRating"
                        name="rating"
                        min="1"
                        max="10"
                        step="0.1"
                        required
                        />
                    </div>

                    <!-- Notes -->
                    <div class="mb-3">
                        <label for="editWatchListNotes" class="form-label fw-bold">
                        Notes / Review
                        </label>
                        <textarea
                        class="form-control"
                        id="editWatchListNotes"
                        name="notes"
                        rows="3"
                        placeholder="Update your thoughts..."
                        ></textarea>
                    </div>
                </div>
              </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer" style="border-top: 2px solid #ddd;">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn" style="background-color: #0d6efd; color: white;">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Script Javascript untuk Preview Gambar di Modal Edit -->
    <script>
        function previewImageEdit(input) {
            const preview = document.getElementById('imgPreviewEdit');
            const placeholder = document.getElementById('placeholderEdit');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                }
                reader.readAsDataURL(input.files[0]);
            }
            // Note: Jika user cancel pilih file, kita biarkan gambar lama (tidak reset ke placeholder)
        }
    </script>
</th:block>