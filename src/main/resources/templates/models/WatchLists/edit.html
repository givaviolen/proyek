<th:block th:fragment="editWatchListModal">
    <!-- Modal Edit Watch List -->
    <div class="modal fade" id="editWatchListModal" tabindex="-1" aria-labelledby="editWatchListModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="background-color: #fcfbf4; border: 2px solid #000;">
          
          <div class="modal-header" style="border-bottom: 2px solid #ddd;">
            <h5 class="modal-title fw-bold" id="editWatchListModalLabel" style="color: #1a1a1a;">
              Edit WatchList Data
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <!-- FIXED: Action ke /watchlists/edit dan support Multipart -->
          <form th:action="@{/watchlists/edit}" method="post" enctype="multipart/form-data">
            <div class="modal-body">
              
              <!-- Hidden ID (Penting) -->
              <input type="hidden" id="editWatchListId" name="id" />

              <div class="row">
                <!-- Kolom Kiri: Poster Image -->
                <div class="col-md-4 mb-3 d-flex flex-column align-items-center">
                    <label class="form-label fw-bold w-100">Poster Image</label>
                    
                    <div class="mb-2" style="width: 100%; height: 250px; border: 2px dashed #c4a45e; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; background-color: #f0eee4;">
                        <img id="imgPreviewEdit" src="#" alt="Preview" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                        <div id="placeholderEdit" class="text-center text-muted">
                            <i class="bi bi-image fs-1"></i>
                            <div style="font-size: 12px;">Poster Saat Ini</div>
                        </div>
                    </div>

                    <!-- Input File -->
                    <input class="form-control form-control-sm" type="file" id="coverImageEdit" name="coverImage" accept="image/*" onchange="previewImageEdit(this)">
                    <div class="form-text text-muted text-center" style="font-size: 11px;">Kosongkan jika tidak ingin mengubah gambar</div>
                </div>

                <!-- Kolom Kanan: Input Fields -->
                <div class="col-md-8">
                    <!-- Title -->
                    <div class="mb-3">
                        <label for="editWatchListTitle" class="form-label fw-bold">Title <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editWatchListTitle" name="title" required />
                    </div>

                    <div class="row">
                        <!-- Type -->
                        <div class="col-md-6 mb-3">
                            <label for="editWatchListType" class="form-label fw-bold">Type <span class="text-danger">*</span></label>
                            <select class="form-select" id="editWatchListType" name="type" required>
                                <option value="Movie">Movie</option>
                                <option value="Series">Series</option>
                            </select>
                        </div>

                        <!-- Status (DIPERBAIKI DISINI) -->
                        <div class="col-md-6 mb-3">
                            <label for="editWatchListStatus" class="form-label fw-bold">Status <span class="text-danger">*</span></label>
                            <!-- Diubah dari isWatched (boolean) menjadi status (String) agar muat 3 opsi -->
                            <select class="form-select" id="editWatchListStatus" name="status" required>
                                <option value="Plan to Watch">Plan to Watch</option>
                                <option value="Watching">Watching</option>
                                <option value="Watched">Watched</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Genre -->
                        <div class="col-md-6 mb-3">
                            <label for="editWatchListGenre" class="form-label fw-bold">Genre <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editWatchListGenre" name="genre" required />
                        </div>

                        <!-- Release Year -->
                        <div class="col-md-6 mb-3">
                            <label for="editWatchListReleaseYear" class="form-label fw-bold">Year <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="editWatchListReleaseYear" name="releaseYear" required />
                        </div>
                    </div>

                    <!-- Rating -->
                    <div class="mb-3">
                        <label for="editWatchListRating" class="form-label fw-bold">Rating (1-10) <span class="text-danger">*</span></label>
                        <input type="number" class="form-control" id="editWatchListRating" name="rating" min="1" max="10" step="1" required />
                    </div>

                    <!-- Notes -->
                    <div class="mb-3">
                        <label for="editWatchListNotes" class="form-label fw-bold">Notes</label>
                        <textarea class="form-control" id="editWatchListNotes" name="notes" rows="3"></textarea>
                    </div>
                </div>
              </div>
            </div>

            <div class="modal-footer" style="border-top: 2px solid #ddd;">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn" style="background-color: #0d6efd; color: white;">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
        function previewImageEdit(input) {
            const preview = document.getElementById('imgPreviewEdit');
            const placeholder = document.getElementById('placeholderEdit');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) { 
                    preview.src = e.target.result; 
                    preview.style.display = 'block'; 
                    placeholder.style.display = 'none'; 
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</th:block>